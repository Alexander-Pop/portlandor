webpackJsonp([1],{"/KFX":function(e,t,a){"use strict";var n=a("Dd8w"),s=a.n(n),i=a("NYxO"),r=a("M4fF"),o={name:"Search",data:function(){return{searchValue:""}},computed:s()({},Object(i.d)(["error"])),methods:s()({update:r.debounce(function(e){this.searchValue&&this.suggest(this.searchValue)},1e3),cancelEdit:function(e){this.searchValue=""}},Object(i.b)(["suggest"]))},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"addressSearchBar"}},[a("div",{staticClass:"input-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.searchValue,expression:"searchValue"}],staticClass:"form-control",attrs:{type:"text",id:"addressSearch",placeholder:"Search for a location..."},domProps:{value:e.searchValue},on:{keypress:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?(t.preventDefault(),t.stopPropagation(),e.update(t)):null},keyup:function(t){return"button"in t||!e._k(t.keyCode,"esc",27,t.key,"Escape")?e.cancelEdit(t):null},input:function(t){t.target.composing||(e.searchValue=t.target.value)}}}),e._v(" "),a("span",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.update}},[e._v("Search")])])])])},staticRenderFns:[]};var l=a("VU/8")(o,c,!1,function(e){a("tUae")},null,null);t.a=l.exports},0:function(e,t,a){a("j1ja"),e.exports=a("OZ/X")},"0iPh":function(e,t){e.exports=jQuery},"3GDu":function(e,t,a){"use strict";var n=a("Dd8w"),s=a.n(n),i=a("d7EF"),r=a.n(i),o=a("NYxO"),c=a("Meid"),l={name:"Map",components:{},created:function(){var e=this;c.loadModules(["esri/Map","esri/views/MapView","esri/widgets/Locate","esri/geometry/Extent"]).then(function(t){var a=r()(t,4),n=a[0],s=a[1],i=a[2],o=a[3],c=new n({basemap:e.settings.basemap||"streets-vector"}),l=(new o(e.extent),new s({container:e.settings.mapid,map:c,zoom:e.settings.zoom.start||10,center:[e.settings.center.lon,e.settings.center.lat]}));if(e.setMapView(l),e.widget){var u=new i({view:l});l.ui.add(u,{position:"top-left"})}if(e.settings.value)for(var d in e.settings.value)if(e.settings.value.hasOwnProperty(d)){var p=e.settings.value[d];e.addWkt(p.wkt)}})},computed:s()({style:function(){return{width:this.settings.width,height:this.settings.height}}},Object(o.d)({widget:"widget",settings:"settings",extent:"extent",value:"value",mapView:function(e){return e.map.mapView}})),methods:s()({},Object(o.b)(["addWkt","setMapView"]))},u={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"portland-geofield-map-app",style:this.style,attrs:{id:this.settings.mapid}},[this._t("default")],2)},staticRenderFns:[]};var d=a("VU/8")(l,u,!1,function(e){a("ikSH")},null,null);t.a=d.exports},Ghpi:function(e,t){},HIMU:function(e,t){},IcnI:function(e,t,a){"use strict";var n=a("7+uW"),s=a("NYxO"),i=a("Meid"),r=a("Zrlr"),o=a.n(r),c=a("wxAW"),l=a.n(c),u=a("mtWM"),d=a.n(u),p=function(){function e(t){o()(this,e),this.apiKey=t}return l()(e,[{key:"suggestAddress",value:function(e,t,a,n){var s=new URLSearchParams;for(var i in s.append("query",e),s.append("api_key",this.apiKey),t)t.hasOwnProperty(i)&&s.append(i,t[i]);return d.a.post("https://www.portlandmaps.com/api/suggest/",s).then(function(t){t.data&&"success"===t.data.status&&t.data.candidates?t.data.candidates[0]?a({location:t.data.candidates[0].location,spatialReference:t.data.spatialReference}):n('Portlandmaps.com could not suggest a location for "'+e+'"'):t.data&&"error"===t.data.status?n("Portlandmaps.com responded with an error."):n("Did not receive a valid response from portlandmaps.com.")}).catch(function(e){n("Portlandmaps.com responded with an error.")})}}]),e}(),f=a("d7EF"),m=a.n(f),h=a("rvVx"),g=a("ellH"),v=a.n(g),y=a("39EV"),w=a.n(y);function b(e){var t,a,n,s,i=0,r=0,o=[];n=e.match(/((\+|\-)[^\+\-]+)/g),s=parseInt(n[0],32);for(var c=1;c<n.length;c+=2)i=t=parseInt(n[c],32)+i,r=a=parseInt(n[c+1],32)+r,o.push([t/s,a/s]);return o}function F(e){return function(e,t){for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}(e[0],e[e.length-1])||e.push(e[0]),e}function k(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t}function M(e){for(var t,a=0,n=0,s=e.length,i=e[n];n<s-1;n++)a+=((t=e[n+1])[0]-i[0])*(t[1]+i[1]),i=t;return a>=0}function V(e){var t=[],a=e.slice(0),n=F(a.shift().slice(0));if(n.length>=4){M(n)||n.reverse(),t.push(n);for(var s=0;s<a.length;s++){var i=F(a[s].slice(0));i.length>=4&&(M(i)&&i.reverse(),t.push(i))}}return t}function _(e,t){var a=w.a.Tools.arraysIntersectArrays(e,t),n=w.a.Tools.coordinatesContainPoint(e,t[0]);return!(a||!n)}var x={parse:function e(t,a){var n={};return(a=a||{}).idAttribute=a.idAttribute||void 0,!t.spatialReference||3857!==t.spatialReference.wkid&&102100!==t.spatialReference.wkid||(n.crs=w.a.MercatorCRS),"number"==typeof t.x&&"number"==typeof t.y&&(n.type="Point",n.coordinates=[t.x,t.y],(t.z||t.m)&&n.coordinates.push(t.z),t.m&&n.coordinates.push(t.m)),t.points&&(n.type="MultiPoint",n.coordinates=t.points.slice(0)),t.paths&&(1===t.paths.length?(n.type="LineString",n.coordinates=t.paths[0].slice(0)):(n.type="MultiLineString",n.coordinates=t.paths.slice(0))),t.rings&&(n=function(e){for(var t,a,n,s=[],i=[],r=0;r<e.length;r++){var o=F(e[r].slice(0));if(!(o.length<4))if(M(o)){var c=[o];s.push(c)}else i.push(o)}for(var l=[];i.length;){n=i.pop();var u=!1;for(t=s.length-1;t>=0;t--)if(_(a=s[t][0],n)){s[t].push(n),u=!0;break}u||l.push(n)}for(;l.length;){n=l.pop();var d=!1;for(t=s.length-1;t>=0;t--)if(a=s[t][0],w.a.Tools.arraysIntersectArrays(a,n)){s[t].push(n),d=!0;break}d||s.push([n.reverse()])}return 1===s.length?{type:"Polygon",coordinates:s[0]}:{type:"MultiPolygon",coordinates:s}}(t.rings.slice(0))),(t.compressedGeometry||t.geometry||t.attributes)&&(n.type="Feature",t.compressedGeometry&&(t.geometry={paths:[b(t.compressedGeometry)]}),n.geometry=t.geometry?e(t.geometry):null,n.properties=t.attributes?k(t.attributes):null,t.attributes&&(n.id=t.attributes[a.idAttribute]||t.attributes.OBJECTID||t.attributes.FID)),new w.a.Primitive(n)},convert:function e(t,a){var n,s=(a=a||{}).idAttribute||"OBJECTID";n=a.sr?{wkid:a.sr}:t&&t.crs&&"urn:ogc:def:crs:OGC:1.3:CRS84"!=t.crs.properties.name?null:{wkid:4326};var i,r={};switch(t.type){case"Point":r.type="point",r.x=t.coordinates[0],r.y=t.coordinates[1],t.coordinates[2]&&(r.z=t.coordinates[2]),t.coordinates[3]&&(r.m=t.coordinates[3]),r.spatialReference=n;break;case"MultiPoint":r.type="multipoint",r.points=t.coordinates.slice(0),r.spatialReference=n;break;case"LineString":r.type="polyline",r.paths=[t.coordinates.slice(0)],r.spatialReference=n;break;case"MultiLineString":r.type="polyline",r.paths=t.coordinates.slice(0),r.spatialReference=n;break;case"Polygon":r.type="polygon",r.rings=V(t.coordinates.slice(0)),r.spatialReference=n;break;case"MultiPolygon":r.rings=function(e){for(var t=[],a=0;a<e.length;a++)for(var n=V(e[a]),s=n.length-1;s>=0;s--){var i=n[s].slice(0);t.push(i)}return t}(t.coordinates.slice(0)),r.spatialReference=n;break;case"Feature":t.geometry&&(r.geometry=e(t.geometry,a)),r.attributes=t.properties?k(t.properties):{},t.id&&(r.attributes[s]=t.id);break;case"FeatureCollection":for(r=[],i=0;i<t.features.length;i++)r.push(e(t.features[i],a));break;case"GeometryCollection":for(r=[],i=0;i<t.geometries.length;i++)r.push(e(t.geometries[i],a))}return r},parseCompressedGeometry:function(e){return new w.a.LineString(b(e))}},E=function(e){if(e){var t=v.a.parse(e);return x.convert(t)}},O=function(e){if(e){var t=x.parse(e);return v.a.convert(t)}},S={},C={};i.loadModules(["esri/geometry/Point","esri/Graphic"]).then(function(e){var t=m()(e,2),a=t[0],n=t[1];S=a,C=n});var D={state:{mapView:{},values:[],center:{},zoom:{start:12,focus:16}},getters:{},actions:{setMapView:function(e,t){(0,e.commit)("setMapView",{mapView:t})},addWkt:function(e,t){e.commit;(0,e.dispatch)("addGeometry",E(t))},addGeometry:function(e,t){var a=e.commit,n=e.state,s=new C({geometry:t,symbol:h.a[t.type]});n.mapView.when(function(){a("addGraphic",{graphic:s})}),a("clearActiveButton")},clearGraphics:function(e){(0,e.commit)("clearGraphics")},center:function(e,t){var a=e.commit,n=t.location,s=t.spatialReference;a("center",{point:new S({x:n.x,y:n.y,spatialReference:s})}),a("focus")}},mutations:{setMapView:function(e,t){var a=t.mapView;e.mapView=a},addGraphic:function(e,t){var a=t.graphic;e.mapView.graphics.add(a),e.mapView.goTo({target:a,zoom:e.zoom.focus})},clearGraphics:function(e){e.mapView.graphics.removeAll()},center:function(e,t){var a=t.point;e.mapView.goTo({center:a,zoom:e.zoom.focus})},focus:function(e){e.mapView.zoom=e.zoom.focus}}},R={state:{sketchViewModel:{},activeButton:""},getters:{},actions:{setSketchViewModel:function(e,t){(0,e.commit)("setSketchViewModel",{sketchViewModel:t})},draw:function(e,t){var a=e.commit;e.state,a("setActiveButton",{type:t}),a("clearGraphics"),a("setMessage",{message:{id:"MAP_HELP",text:"point"===t?"Drawing started... Click to place a point.":'Drawing started... Double-click or press "c" to end drawing.',type:"info"}}),a("startDraw",{type:t})}},mutations:{setSketchViewModel:function(e,t){var a=t.sketchViewModel;e.sketchViewModel=a},startDraw:function(e,t){var a=t.type;e.sketchViewModel.create(a)},setActiveButton:function(e,t){var a=t.type;e.activeButton=a},clearActiveButton:function(e){e.activeButton=""}}},A=new p("4F82E619ACB509A261A1D3E9C146E190"),G={state:{},getters:{},actions:{suggest:function(e,t){var a=e.commit,n=e.dispatch;a("clearMessages"),A.suggestAddress(t,{},function(e){n("center",{location:e.location,spatialReference:e.spatialReference})},function(e){a("setMessage",{message:{id:"PORTLANDMAPS_REQUEST_ERROR",text:e,type:"danger"}})})}},mutations:{}},P=a("mvHQ"),B=a.n(P),U=function(){function e(){o()(this,e)}return l()(e,[{key:"getAddress",value:function(e,t){var a="https://www.portlandmaps.com/arcgis/rest/services/Public/Address_Geocoding_PDX/GeocodeServer/reverseGeocode?location="+t+","+e+"&f=json";return d.a.get(encodeURI(a))}},{key:"geocodeAddress",value:function(e){var t={records:[{attributes:{OBJECTID:1,Street:e.street,City:e.city,State:e.state,Zip:e.zip}}]},a=GEOCODE_ADDRESS_URL+"?addresses="+B()(t)+"&f=json";return d.a.get(encodeURI(a))}}]),e}(),j=a("0iPh"),I=a.n(j),z={Street:"address-line1",City:"locality",State:"administrative-area",ZIP:"postal-code"},T={OREGON:"OR"},L=function(){function e(t){var a=this;o()(this,e);var n=".field--type-address.field--name-"+t.replace(/_/g,"-");this.addressField=I()(n),this.address={},I()(document).ajaxComplete(function(e,n,s){s.extraData&&s.extraData._drupal_ajax&&s.extraData._triggering_element_name===t+"[0][address][country_code]"&&a.fillFields()})}return l()(e,[{key:"fillFields",value:function(){for(var e in z)if(z.hasOwnProperty(e)){var t=z[e];"State"===e&&(this.address[e]=T[this.address[e]]||this.address[e]),this.addressField.find("."+t).val(this.address[e]).change()}}},{key:"set",value:function(e){this.address=e,this.addressField.find(".country.form-select").length?this.addressField.find(".country.form-select").val("US").trigger("change"):this.fillFields()}}]),e}(),N=function(){function e(t){o()(this,e),this.valueField=document.getElementById(t)}return l()(e,[{key:"set",value:function(e){this.valueField.value=O(e)}},{key:"clear",value:function(){this.valueField.value=NULL}},{key:"get",value:function(){return this.valueField.value}}]),e}(),W={state:{addressField:"field_facility_address",valueField:"edit-field-geometry-0-value-wkt"},getters:{},actions:{setAddressField:function(e,t){var a=e.commit,n=(e.state,e.dispatch);(new U).getAddress(t.y,t.x).then(function(e){!e||e.data.error?n("setMessage",{id:"GEOCODESERVER_GEOCODE_ERROR",text:"Unable to geocode an address for the geometry.",type:"danger"}):e.data.address&&a("setAddressField",{address:e.data.address})})},setValueField:function(e,t){var a=e.commit;e.state,e.dispatch;a("setValueField",{geometry:t})}},mutations:{setAddressField:function(e,t){var a=t.address;new L(e.addressField).set(a)},clearValueField:function(e){new N(e.valueField).clear()},setValueField:function(e,t){var a=t.geometry;new N(e.valueField).set(a)}}};n.a.use(s.a);new p("28D3F96A84990C0554495C07309117EF"),t.a=new s.a.Store({modules:{map:D,drawbar:R,search:G,field:W},state:{messages:[],widget:!1,settings:{wktid:"",mapid:"",width:"100%",height:"50vh",center:{lon:-13656529.895,lat:5703070.921},zoom:{start:12,focus:16},value:{}}},getters:{mapid:function(e){return e.settings.mapid+"-app"}},actions:{initialize:function(){},setMessage:function(e,t){(0,e.commit)("setMessage",{message:t})},clearMessages:function(e){(0,e.commit)("clearMessages")}},mutations:{setMessage:function(e,t){var a=t.message;e.messages=[a]},clearMessages:function(e){e.messages=[]}}})},"OZ/X":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("7+uW"),s=a("Dd8w"),i=a.n(s),r=a("NYxO"),o=a("3GDu"),c=a("mqSb"),l=a("Ty8c"),u=a("/KFX"),d={name:"Widget",components:{Map:o.a,Messages:c.a,Drawbar:l.a,Search:u.a},computed:i()({},Object(r.c)(["mapid"])),methods:{}},p={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:this.mapid}},[t("Messages"),this._v(" "),t("Map",[t("Drawbar"),this._v(" "),t("Search")],1)],1)},staticRenderFns:[]};var f=a("VU/8")(d,p,!1,function(e){a("HIMU")},null,null).exports,m=a("IcnI");!function(e,t,a){t.behaviors.esri={attach:function(t,a){a.portland_geofield_map&&e(t).find(".portland-geofield-map").once("portland_processed").each(function(t,s){var i=e(s).attr("id"),r=a.portland_geofield_map[i];new n.a({el:"#"+i,store:m.a,components:{Widget:f},template:"<Widget/>"});m.a.state.settings=r,m.a.state.widget=!0,m.a.state.field.addressField=r.addressField,m.a.state.field.valueField=r.wktid})}}}(jQuery,Drupal,drupalSettings)},Ty8c:function(e,t,a){"use strict";var n=a("Dd8w"),s=a.n(n),i=a("d7EF"),r=a.n(i),o=a("NYxO"),c=a("Meid"),l={point:"esri-icon-blank-map-pin",multipoint:"esri-icon-handle-horizontal",line:"",polyline:"esri-icon-polyline",polygon:"esri-icon-polygon"},u={name:"DrawButton",props:["type"],computed:s()({icon:function(){return l[this.type]},title:function(){return"Draw "+this.type},active:function(){return this.type===this.activeButton}},Object(o.d)({activeButton:function(e){return e.drawbar.activeButton}})),methods:s()({},Object(o.b)(["draw"]))},d={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("button",{class:[{"action-button":!0,active:e.active},e.icon,e.type],attrs:{name:e.type,type:"button",title:e.title},on:{click:function(t){e.draw(e.type,t)}}})},staticRenderFns:[]};var p=a("VU/8")(u,d,!1,function(e){a("VOC/")},null,null).exports,f=a("rvVx"),m={name:"Drawbar",components:{DrawButton:p},created:function(){var e=this;c.loadModules(["esri/widgets/Sketch/SketchViewModel"]).then(function(t){var a=new(0,r()(t,1)[0])({view:e.mapView,pointSymbol:f.a.point,polylineSymbol:f.a.polyline,polygonSymbol:f.a.polygon});a.on("draw-complete",function(t){e.clearMessages();var a=t.geometry;e.addGeometry(a);var n={};n=a.extent?{x:a.extent.center.x,y:a.extent.center.y}:{x:a.x,y:a.y},e.setAddressField(n),c.loadModules(["esri/geometry/support/webMercatorUtils"]).then(function(t){var n=r()(t,1)[0];e.setValueField(n.webMercatorToGeographic(a))})}),e.setSketchViewModel(a)})},computed:s()({},Object(o.d)({sketchViewModel:function(e){return e.drawbar.sketchViewModel},mapView:function(e){return e.map.mapView}})),methods:s()({},Object(o.b)(["clearGraphics","setSketchViewModel","addGeometry","setAddressField","setValueField","clearMessages"]))},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"topbar"},[t("DrawButton",{attrs:{type:"point"}}),this._v(" "),t("DrawButton",{attrs:{type:"multipoint"}}),this._v(" "),t("DrawButton",{attrs:{type:"polyline"}}),this._v(" "),t("DrawButton",{attrs:{type:"polygon"}}),this._v(" "),t("button",{staticClass:"action-button esri-icon-trash reset",attrs:{name:"reset",type:"button",title:"Clear graphics"},on:{click:this.clearGraphics}})],1)},staticRenderFns:[]};var g=a("VU/8")(m,h,!1,function(e){a("Ghpi")},null,null);t.a=g.exports},"VOC/":function(e,t){},fCOT:function(e,t){},ikSH:function(e,t){},mqSb:function(e,t,a){"use strict";var n=a("Dd8w"),s=a.n(n),i=a("NYxO"),r={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{class:[this.alertClass,this.typeClass],attrs:{role:"alert"}},[this._v("\n  "+this._s(this.message)+"\n")])},staticRenderFns:[]};var o={name:"Messages",components:{Message:a("VU/8")({name:"Message",props:["message","type"],data:function(){return{alertClass:"alert"}},computed:{typeClass:function(){return"alert-"+this.type}}},r,!1,function(e){a("tCnw")},null,null).exports},computed:s()({},Object(i.d)(["messages"]))},c={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"messages"}},this._l(this.messages,function(e){return t("Message",{key:e.id,attrs:{message:e.text,type:e.type}})}))},staticRenderFns:[]};var l=a("VU/8")(o,c,!1,function(e){a("fCOT")},null,null);t.a=l.exports},rvVx:function(e,t,a){"use strict";t.a={point:{type:"simple-marker",color:"#8A2BE2",size:"14px",outline:{color:"#FFFFFF",width:3}},multipoint:{type:"simple-marker",color:"#8A2BE2",size:"14px",outline:{color:"#FFFFFF",width:3}},polyline:{type:"simple-line",color:"#8A2BE2",width:3},polygon:{type:"simple-fill",color:"#FFFFFF",style:"solid",outline:{color:"#8A2BE2",width:2}}}},tCnw:function(e,t){},tUae:function(e,t){}},[0]);